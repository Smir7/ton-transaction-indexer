## üõ°Ô∏è Escrow Telegram Bot
 #### –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

Escrow Telegram Bot ‚Äî —ç—Ç–æ Telegram-–±–æ—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–¥–µ–ª–∫–∞–º–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≥–∞—Ä–∞–Ω—Ç–∞ (escrow) –Ω–∞ –±–ª–æ–∫—á–µ–π–Ω–µ TON.
–ë–æ—Ç –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É –ø–æ–∫—É–ø–∞—Ç–µ–ª—è–º–∏ –∏ –ø—Ä–æ–¥–∞–≤—Ü–∞–º–∏, 
–∞ —Ç–∞–∫–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º –∞—Ä–±–∏—Ç—Ä–∞–∂–∞ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤.

 ### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –°–æ–∑–¥–∞–Ω–∏–µ —Å–¥–µ–ª–æ–∫ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Å—É–º–º—ã –≤ TON

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –∫–æ–º–∏—Å—Å–∏–∏ 10% –æ—Ç —Å—É–º–º—ã —Å–¥–µ–ª–∫–∏

### –†–æ–ª–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞:

    –ü–æ–∫—É–ø–∞—Ç–µ–ª—å

    –ü—Ä–æ–¥–∞–≤–µ—Ü

    –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä

    –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π —á–µ—Ä–µ–∑ TON API

    –°–∏—Å—Ç–µ–º–∞ –∞—Ä–±–∏—Ç—Ä–∞–∂–∞ –¥–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —Å–ø–æ—Ä–æ–≤

    –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–π —Ä–æ–ª–∏

    –ö–æ–Ω–µ—á–Ω—ã–π –∞–≤—Ç–æ–º–∞—Ç (FSM) –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ —Å–¥–µ–ª–æ–∫

 ### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

    Java 17

    Spring Boot 3.2.3

    Telegram Bot API

    telegrambots-springboot-longpolling-starter 7.10.0

    H2 Database (–≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è, —Ñ–∞–π–ª–æ–≤–∞—è)

    Spring Data JPA

    Lombok

    TON4J ‚Äî —Ä–∞–±–æ—Ç–∞ —Å –±–ª–æ–∫—á–µ–π–Ω–æ–º TON
 
### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
#### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞–∫–µ—Ç—ã

    ru.escrow.bot.bot ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å Telegram-–±–æ—Ç–∞

    ru.escrow.bot.config ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –±–æ—Ç–∞

    ru.escrow.bot.controller ‚Äî –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π Telegram

    ru.escrow.bot.domain ‚Äî –¥–æ–º–µ–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ –∏ enum‚Äô—ã

    ru.escrow.bot.repository ‚Äî JPA-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

    ru.escrow.bot.service ‚Äî –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

    ru.escrow.bot.util ‚Äî –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã

###  –°—É—â–Ω–æ—Å—Ç–∏
#### User
@Entity
@Table(name = "bot_users")
public class User {

    @Id
    private Long telegramId;

    @Enumerated(EnumType.STRING)
    private Role role;

    private String currentDialogState;
}

#### Deal
@Entity
public class Deal {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @ManyToOne
    private User buyer;

    @ManyToOne
    private User seller;

    private Double amount;
    private Double commission; // 10%

    @Enumerated(EnumType.STRING)
    private DealState state;
}

###  –°–æ—Å—Ç–æ—è–Ω–∏—è —Å–¥–µ–ª–æ–∫ (DealState)

    CREATED ‚Äî —Å–æ–∑–¥–∞–Ω–∞

    WAITING_PAYMENT ‚Äî –æ–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—É

    PAID ‚Äî –æ–ø–ª–∞—á–µ–Ω–∞

    IN_PROGRESS ‚Äî –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç

    COMPLETED ‚Äî —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞

    DISPUTE ‚Äî —Å–ø–æ—Ä

    CANCELLED ‚Äî –æ—Ç–º–µ–Ω–µ–Ω–∞ –¥–æ –æ–ø–ª–∞—Ç—ã

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∑–∞–ø—É—Å–∫
#### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

    Java 17

    Maven

    Telegram Bot Token

    TON-–∫–æ—à–µ–ª–µ–∫

    API-–∫–ª—é—á TON

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

- –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª application.yml:

        bot:
            token: YOUR_BOT_TOKEN
            username: YOUR_BOT_USERNAME

        server:
            port: 8081

        spring:
            datasource:
                url: jdbc:h2:file:./data/db
                driver-class-name: org.h2.Driver
        jpa:
            hibernate:
                ddl-auto: update
            database-platform: org.hibernate.dialect.H2Dialect

        ton:
            api:
                key: YOUR_TON_API_KEY
            wallet: YOUR_TON_WALLET_ADDRESS

## –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
### –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
     mvn clean package

### –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    java -jar target/ton-escrow-telegram-bot-1.0.0.jar

### –†–∞–±–æ—Ç–∞ —Å –±–æ—Ç–æ–º
–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
–î–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

    /start ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

    /help ‚Äî —Å–ø—Ä–∞–≤–∫–∞ –ø–æ –±–æ—Ç—É

–î–ª—è –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π

    /deal ‚Äî —Å–æ–∑–¥–∞—Ç—å —Å–¥–µ–ª–∫—É

    /my_orders ‚Äî –º–æ–∏ –∑–∞–∫–∞–∑—ã

    /pay ‚Äî –æ–ø–ª–∞—Ç–∏—Ç—å —Å–¥–µ–ª–∫—É

–î–ª—è –ø—Ä–æ–¥–∞–≤—Ü–æ–≤

    /my_orders ‚Äî –º–æ–∏ –∑–∞–∫–∞–∑—ã

    /disputes ‚Äî –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–ø–æ—Ä—ã

–î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

    /disputes ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø–æ—Ä–∞–º–∏

### –ü—Ä–æ—Ü–µ—Å—Å —Å–¥–µ–ª–∫–∏

#### –°–æ–∑–¥–∞–Ω–∏–µ
–ü–æ–∫—É–ø–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç 
    /deal
–∑–∞—Ç–µ–º —Å—É–º–º—É –≤ TON

#### –ü—Ä–∏–Ω—è—Ç–∏–µ
–ü—Ä–æ–¥–∞–≤–µ—Ü –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–¥–µ–ª–∫—É —á–µ—Ä–µ–∑ 
/accept_{id}

#### –û–ø–ª–∞—Ç–∞
–ü–æ–∫—É–ø–∞—Ç–µ–ª—å –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç —Å–¥–µ–ª–∫—É –∫–æ–º–∞–Ω–¥–æ–π 
/pay

#### –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
–ü—Ä–æ–¥–∞–≤–µ—Ü –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Å–¥–µ–ª–∫—É —á–µ—Ä–µ–∑ 
/done_{id}

#### –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ
–°–¥–µ–ª–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Å—Ç–∞—Ç—É—Å COMPLETED

#### –ê—Ä–±–∏—Ç—Ä–∞–∂

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ —Å–ø–æ—Ä–∞ –ª—é–±–æ–π —É—á–∞—Å—Ç–Ω–∏–∫ –º–æ–∂–µ—Ç –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å –∞—Ä–±–∏—Ç—Ä–∞–∂:
/dispute_{id}


–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∏ –º–æ–∂–µ—Ç:

- –ø—Ä–∏–Ω—è—Ç—å —Ä–µ—à–µ–Ω–∏–µ –≤ –ø–æ–ª—å–∑—É –ø—Ä–æ–¥–∞–≤—Ü–∞

- –ø—Ä–∏–Ω—è—Ç—å —Ä–µ—à–µ–Ω–∏–µ –≤ –ø–æ–ª—å–∑—É –ø–æ–∫—É–ø–∞—Ç–µ–ª—è

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
    –ö–æ–Ω–µ—á–Ω—ã–π –∞–≤—Ç–æ–º–∞—Ç (FSM)

    FSM —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ FSMService –∏ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ —Å–¥–µ–ª–æ–∫.

    –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π

    –°–µ—Ä–≤–∏—Å TonTransactionChecker –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–∞ TON-–∫–æ—à–µ–ª—å–∫–µ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥.

    –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã

    –ö–ª–∞—Å—Å KeyboardUtil —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

    –í—Å–µ —Ç–æ–∫–µ–Ω—ã –∏ –∫–ª—é—á–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

    –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –ø–æ —Ä–æ–ª—è–º

    –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ —Å–æ—Å—Ç–æ—è–Ω–∏–π —Å–¥–µ–ª–æ–∫

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

src/main/java/ru/escrow/bot/
‚îú‚îÄ‚îÄ Application.java
‚îÇ
‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ EscrowBot.java
‚îÇ
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ BotConfig.java
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ BotCommandsInitializer.java
‚îÇ
‚îú‚îÄ‚îÄ controller/
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ UpdateRouter.java
‚îú‚îÄ‚îÄ domain/
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ Deal.java
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ DealState.java
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ Role.java
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ User.java
‚îú‚îÄ‚îÄ repository/
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ DealRepository.java
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ UserRepository.java
‚îú‚îÄ‚îÄ service/
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ ArbitrationService.java
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ DealService.java
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ FSMService.java
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ TonPaymentService.java
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ TonTransactionChecker.java
‚îî‚îÄ‚îÄ util/
‚îú‚îÄ‚îÄ KeyboardUtil.java
‚îÇ   
‚îî‚îÄ‚îÄ MessageUtil.java

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

TON testnet 
- –∑–∞–ø—Ä–æ—Å –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö TON —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ 
    –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±—å–Ω–æ—Å—Ç–∏ –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã

–ó–∞–≥–ª—É—à–∫–∏ –∏–ª–∏ mock-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ TON API

### –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ø—Ä–æ–ø—Ä–∏–µ—Ç–∞—Ä–Ω–æ–π –ª–∏—Ü–µ–Ω–∑–∏–µ–π.
–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Ç–æ–∫–µ–Ω—ã, –∫–ª—é—á–∏) —É–¥–∞–ª–µ–Ω—ã –∏–∑ –ø—É–±–ª–∏—á–Ω–æ–π –≤–µ—Ä—Å–∏–∏.

###                                                                                                                                                   –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ü–æ –≤–æ–ø—Ä–æ—Å–∞–º –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º –ø—Ä–æ–µ–∫—Ç–∞.

## –í–∞–∂–Ω–æ:
    - –í –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏: 
        - —Å–º–µ–Ω–∞ —Ä–æ–ª–µ–π –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
  
### –ó–∞–ø—É—Å–∫ –≤ prod–∞ct —Å —Ç–∞–∫–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –Ω–µ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è

### –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø–µ—Ä–µ—Ö–æ–¥—É –ø–æ –ø–µ—Ä–µ–Ω–∞—Å—Ç—Ä–æ–π–∫–µ
    - –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥–∞ —Ä–æ–ª–µ–π –¥–ª—è –∑–∞–∫–∞–∑—á–∏–∫–∞ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–ê–≤—Ç–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞
(–ì–æ–Ω—á–∞—Ä–æ–≤–∞ –û–ª—å–≥–∞)
